"""
æç¤ºè¯æ¨¡æ¿æ¨¡å—
åŒ…å«å„ç§ AI ç”Ÿæˆä»»åŠ¡çš„æç¤ºè¯
"""

from typing import Dict, Any


class PromptTemplates:
    """æç¤ºè¯æ¨¡æ¿ç±»"""

    # ä¸»ç³»ç»Ÿæç¤ºè¯
    SYSTEM_PROMPT = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…æ¸¸è§„åˆ’åŠ©æ‰‹ï¼Œæ“…é•¿ä¸ºç”¨æˆ·åˆ¶å®šä¸ªæ€§åŒ–ã€å®ç”¨çš„æ—…è¡Œæ”»ç•¥ã€‚

è¯·æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ï¼Œç”Ÿæˆä¸€ä»½è¯¦ç»†çš„æ—…æ¸¸æ”»ç•¥ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

## æ”»ç•¥ç»“æ„
1. **è¡Œç¨‹æ¦‚è§ˆ** ğŸ“‹
   - è¡Œç¨‹å¤©æ•°å®‰æ’
   - æ•´ä½“é¢„ç®—åˆ†é…å»ºè®®
   - æœ€ä½³æ—…è¡Œæ—¶é—´è¯´æ˜

2. **æ™¯ç‚¹æ¨è** ğŸ›ï¸
   - å¿…æ¸¸æ™¯ç‚¹è¯¦ç»†ä»‹ç»
   - é—¨ç¥¨ä»·æ ¼ä¿¡æ¯
   - å…è´¹æ—¶æ®µ/ä¼˜æƒ æ”¿ç­–
   - æ¸¸è§ˆæ—¶é—´å»ºè®®
   - æ™¯ç‚¹é—´è·ç¦»å‚è€ƒ

3. **åœè½¦ä¿¡æ¯** ğŸ…¿ï¸
   - æ¨èåœè½¦åœºä½ç½®
   - åœè½¦è´¹ç”¨æ ‡å‡†
   - åœè½¦åœºè¥ä¸šæ—¶é—´
   - æ˜¯å¦éœ€è¦é¢„çº¦

4. **ç¾é£Ÿæ¨è** ğŸœ
   - å½“åœ°ç‰¹è‰²ç¾é£Ÿä»‹ç»
   - æ¨èé¤å…ï¼ˆè€ƒè™‘é¢„ç®—ï¼‰
   - äººå‡æ¶ˆè´¹å‚è€ƒ
   - æœ¬åœ°äººæ¨èçš„å°åº—

5. **ä½å®¿æ¨è** ğŸ¨
   - æ ¹æ®é¢„ç®—æ¨èä½å®¿åŒºåŸŸ
   - ä¸åŒä»·ä½é…’åº—/æ°‘å®¿æ¨è
   - ä½å®¿åœ°ç‚¹äº¤é€šä¾¿åˆ©æ€§åˆ†æ

6. **å¤©æ°”ç©¿è¡£** ğŸ‘”
   - æ ¹æ®å¤©æ°”æƒ…å†µç»™å‡ºç©¿è¡£å»ºè®®
   - ç‰¹æ®Šå¤©æ°”æ³¨æ„äº‹é¡¹
   - æ¨èæºå¸¦ç‰©å“

7. **äº¤é€šè§„åˆ’** ğŸš—
   - ä»å‡ºå‘åœ°åˆ°ç›®çš„åœ°çš„äº¤é€šæ–¹å¼
   - å½“åœ°äº¤é€šå¡/æ‰“è½¦å»ºè®®
   - æ™¯ç‚¹é—´äº¤é€šè·¯çº¿

## è¾“å‡ºè¦æ±‚
- å†…å®¹è¯¦å®ã€æ¡ç†æ¸…æ™°
- ä¸¥æ ¼è€ƒè™‘ç”¨æˆ·çš„é¢„ç®—èŒƒå›´
- ç»“åˆç”¨æˆ·åå¥½ç»™å‡ºä¸ªæ€§åŒ–å»ºè®®
- æä¾›å®ç”¨çš„çœé’± Tips
- ä½¿ç”¨ Markdown æ ¼å¼æ’ç‰ˆ
- é€‚å½“ä½¿ç”¨ emoji å¢å¼ºå¯è¯»æ€§
- ä»·æ ¼ä¿¡æ¯å°½é‡å‡†ç¡®ï¼ˆå¦‚ä¸ç¡®å®šè¯·æ ‡æ³¨"å‚è€ƒä»·æ ¼"ï¼‰

è¯·ä»¥å‹å¥½ã€ä¸“ä¸šçš„è¯­æ°”å›å¤ï¼Œè®©ç”¨æˆ·çš„æ—…è¡Œæ›´åŠ é¡ºåˆ©æ„‰å¿«ï¼"""

    @staticmethod
    def build_user_prompt(user_request: Dict[str, Any], weather_info: str = "") -> str:
        """
        æ„å»ºç”¨æˆ·è¾“å…¥æç¤ºè¯

        Args:
            user_request: ç”¨æˆ·è¯·æ±‚æ•°æ®
            weather_info: å¤©æ°”ä¿¡æ¯æ–‡æœ¬

        Returns:
            å®Œæ•´çš„ç”¨æˆ·æç¤ºè¯
        """
        destination = user_request.get("destination", "")
        origin = user_request.get("origin", "")
        start_date = user_request.get("start_date", "")
        end_date = user_request.get("end_date", "")
        budget = user_request.get("budget", 0)
        preferences = user_request.get("preferences", "")

        prompt = f"""è¯·ä¸ºæˆ‘çš„æ—…è¡Œåˆ¶å®šä¸€ä»½è¯¦ç»†æ”»ç•¥ï¼š

**ç›®çš„åœ°**: {destination}
**å‡ºå‘åœ°**: {origin}
**å‡ºå‘æ—¥æœŸ**: {start_date}
**è¿”å›æ—¥æœŸ**: {end_date}
**é¢„ç®—**: {budget} å…ƒ
**åå¥½**: {preferences}
"""

        if weather_info:
            prompt += f"\n**å¤©æ°”ä¿¡æ¯**:\n{weather_info}\n"

        prompt += "\nè¯·æ ¹æ®ä»¥ä¸Šä¿¡æ¯ï¼Œä¸ºæˆ‘ç”Ÿæˆä¸€ä»½è¯¦ç»†çš„æ—…æ¸¸æ”»ç•¥ã€‚"

        return prompt

    # æ™¯ç‚¹è¯¦æƒ…æç¤ºè¯
    ATTRACTION_PROMPT = """è¯·è¯¦ç»†ä»‹ç»ä»¥ä¸‹æ™¯ç‚¹ï¼ŒåŒ…æ‹¬ï¼š
1. æ™¯ç‚¹ç‰¹è‰²å’Œäº®ç‚¹
2. é—¨ç¥¨ä»·æ ¼ï¼ˆæˆäººç¥¨ã€å­¦ç”Ÿç¥¨ã€å„¿ç«¥ç¥¨ï¼‰
3. å…è´¹å¼€æ”¾æ—¶æ®µ/ä¼˜æƒ æ”¿ç­–
4. å»ºè®®æ¸¸è§ˆæ—¶é•¿
5. æœ€ä½³æ¸¸è§ˆæ—¶é—´
6. æ¸¸è§ˆæ³¨æ„äº‹é¡¹
7. é™„è¿‘åœè½¦ä½ä¿¡æ¯

è¯·ç”¨æ¸…æ™°çš„æ ¼å¼å‘ˆç°ï¼Œæ–¹ä¾¿ç”¨æˆ·é˜…è¯»ã€‚"""

    # ç¾é£Ÿæ¨èæç¤ºè¯
    FOOD_PROMPT = """è¯·æ¨èå½“åœ°ç‰¹è‰²ç¾é£Ÿï¼ŒåŒ…æ‹¬ï¼š
1. å¿…å°çš„ç‰¹è‰²èœå“
2. æ¨èé¤å…ï¼ˆä¸åŒä»·ä½ï¼‰
3. äººå‡æ¶ˆè´¹å‚è€ƒ
4. æœ¬åœ°äººæ¨èçš„å°åº—
5. ç‰¹è‰²å°åƒè¡—/å¤œå¸‚
6. éœ€è¦é¿é›·çš„æ¸¸å®¢é™·é˜±

è¯·æ ¹æ®ç”¨æˆ·é¢„ç®—ç»™å‡ºåˆç†å»ºè®®ã€‚"""

    # ç©¿è¡£å»ºè®®æç¤ºè¯
    CLOTHING_PROMPT = """æ ¹æ®å¤©æ°”æƒ…å†µï¼Œè¯·ç»™å‡ºç©¿è¡£å»ºè®®ï¼š
1. æ¯æ—¥ç©¿æ­å»ºè®®
2. å¿…å¤‡ç‰©å“æ¸…å•
3. ç‰¹æ®Šå¤©æ°”æ³¨æ„äº‹é¡¹
4. èˆ’é€‚åº¦ä¸ä¿æš–æ€§å¹³è¡¡å»ºè®®

è¯·ç”¨å®ç”¨æ˜“æ‡‚çš„æ–¹å¼å‘ˆç°ã€‚"""

    # äº¤é€šè§„åˆ’æç¤ºè¯
    TRANSPORT_PROMPT = """è¯·è§„åˆ’äº¤é€šè·¯çº¿ï¼š
1. ä»å‡ºå‘åœ°åˆ°ç›®çš„åœ°çš„æœ€ä½³äº¤é€šæ–¹å¼
2. é¢„ä¼°æ—¶é—´å’Œè´¹ç”¨
3. å½“åœ°äº¤é€šå»ºè®®ï¼ˆå…¬äº¤/åœ°é“/æ‰“è½¦/ç§Ÿè½¦ï¼‰
4. æ™¯ç‚¹é—´äº¤é€šè·¯çº¿
5. äº¤é€šå¡/ç¥¨åŠ¡å»ºè®®

è¯·è€ƒè™‘ç»æµæ€§å’Œä¾¿åˆ©æ€§ã€‚"""

    # ä½å®¿æ¨èæç¤ºè¯
    ACCOMMODATION_PROMPT = """è¯·æ¨èä½å®¿åœ°ç‚¹ï¼š
1. ä¸åŒåŒºåŸŸçš„ä¼˜ç¼ºç‚¹åˆ†æ
2. æ ¹æ®é¢„ç®—æ¨èå…·ä½“é…’åº—/æ°‘å®¿
3. ä½å®¿åœ°ç‚¹çš„äº¤é€šä¾¿åˆ©æ€§
4. é¢„è®¢å»ºè®®å’Œæ³¨æ„äº‹é¡¹
5. æ€§ä»·æ¯”æ¨è

è¯·æä¾›çœŸå®æœ‰ç”¨çš„å»ºè®®ï¼Œé¿å…æ˜æ˜¾å¹¿å‘Šã€‚"""

    # è¡Œç¨‹æ€»ç»“æç¤ºè¯
    SUMMARY_PROMPT = """è¯·æ€»ç»“æœ¬æ¬¡æ—…è¡Œæ”»ç•¥ï¼š
1. è¡Œç¨‹äº®ç‚¹å›é¡¾
2. æ€»é¢„ç®—é¢„ä¼°
3. é‡è¦æ³¨æ„äº‹é¡¹æ±‡æ€»
4. åº”æ€¥è”ç³»æ–¹å¼å»ºè®®
5. è¡Œææ¸…å•å»ºè®®

è¯·ç”¨ç®€æ´æ˜äº†çš„æ–¹å¼å‘ˆç°å…³é”®ä¿¡æ¯ã€‚"""

    @classmethod
    def get_prompt(cls, prompt_type: str) -> str:
        """
        è·å–æŒ‡å®šç±»å‹çš„æç¤ºè¯

        Args:
            prompt_type: æç¤ºè¯ç±»å‹
                - system: ç³»ç»Ÿæç¤ºè¯
                - attraction: æ™¯ç‚¹è¯¦æƒ…
                - food: ç¾é£Ÿæ¨è
                - clothing: ç©¿è¡£å»ºè®®
                - transport: äº¤é€šè§„åˆ’
                - accommodation: ä½å®¿æ¨è
                - summary: è¡Œç¨‹æ€»ç»“

        Returns:
            å¯¹åº”çš„æç¤ºè¯
        """
        prompts = {
            "system": cls.SYSTEM_PROMPT,
            "attraction": cls.ATTRACTION_PROMPT,
            "food": cls.FOOD_PROMPT,
            "clothing": cls.CLOTHING_PROMPT,
            "transport": cls.TRANSPORT_PROMPT,
            "accommodation": cls.ACCOMMODATION_PROMPT,
            "summary": cls.SUMMARY_PROMPT,
        }
        return prompts.get(prompt_type, cls.SYSTEM_PROMPT)

    @classmethod
    def format_weather_info(cls, weather_data: Dict[str, Any]) -> str:
        """
        æ ¼å¼åŒ–å¤©æ°”ä¿¡æ¯ç”¨äºæç¤ºè¯

        Args:
            weather_data: å¤©æ°”æ•°æ®

        Returns:
            æ ¼å¼åŒ–çš„å¤©æ°”æ–‡æœ¬
        """
        if not weather_data:
            return ""

        lines = ["ğŸ“ å¤©æ°”é¢„æŠ¥:\n"]

        forecast = weather_data.get("forecast", [])
        for day in forecast:
            date = day.get("date", "")
            temp_max = day.get("temp_max", "")
            temp_min = day.get("temp_min", "")
            weather = day.get("weather_day", "")

            lines.append(f"ğŸ“… {date}: {temp_min}Â°C ~ {temp_max}Â°C, {weather}")

        return "\n".join(lines)
